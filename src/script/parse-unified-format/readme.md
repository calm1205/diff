# unified-format

unified-formatのparse

## logics

1. `git diff`のレスポンスでhunk等をtrim
2. アラインメントを一致させるために空の行を補完
3. 単語の差分を取得し、HTMLに文字列置換
4. originalLinesとmodifiedLinesに分割

<br/><br/>

### アラインメントの一致

差分が複数行で連続し、かつ-の行と+の行数が異なる場合、-の行と+の行を互い違いに並べ替える。

またこの時に前後の文が同じ文であるということをcosign類似度でスコアリングした結果で判定する。

類似度が最も低い文は新たに追加された or 削除された文として扱う。

<br/><br/>

### 単語の差分検出

いきなり異なる単語のみを取得はできそうになかった。

そのため以下の流れで2文間の差分を取得した。

1. 2文（文A,文B）間の共通する単語を取得
2. 文Aから共通する単語を削除したものを差分の行として取得
3. 文Bから共通する単語を削除したものを差分の行として取得

共通する単語は、文の文字を一文字ずつ左から走査し文字が異なる間でを共通する単語として取得した。

e.g.

文A: hello world
文B: hello modified world

文Aの`h`を起点として、文Bの先頭から一致する文字を探す。
一致する文字が見つかったら文Aの次の文字を起点として再度探索を行う。
`hello`までが最初の共通する単語として取得される。（空白は無視）

全部走査仕切ると共通する文字列が`['hello', 'world']`となる。
文Bから共通文字列を取り除くと`['modified']`が取得できるためこれを差分として取得する。
